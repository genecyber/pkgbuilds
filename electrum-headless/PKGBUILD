# Maintainer: Andy Weidenbaum <archbaum@gmail.com>

pkgname=electrum-headless
pkgver=1.9.8
pkgrel=1
pkgdesc="Lightweight Bitcoin wallet, headless version"
arch=('any')
depends=('python2' 'python2-ecdsa' 'python2-pbkdf2' 'python2-slowaes')
url="https://electrum.org"
license=('GPL3')
source=("https://download.electrum.org/${pkgname^}-${pkgver}.tar.gz"{,.asc})
md5sums=('0d9896eddc7532813b29af0bf9010e7b'
         'a779e3907620b47e760511ef51f4b2b5')
sha256sums=('dda754ec254396eae5f0df2e16f3773fa36f52ad03ec0841c52374cd531538fb'
            '0e772cb1d8642dac89f16a8ba838ebdb764920db2944930de0db954666723e29')
provides=('electrum')
install=electrum.install

prepare() {
  cd ${srcdir}/${pkgname^}-${pkgver}

  msg 'Fixing Python version...'
  find . -type f -print0 | xargs -0 sed -i 's#/usr/bin/python#/usr/bin/python2#g'
  find . -type f -print0 | xargs -0 sed -i 's#/usr/bin/env python#/usr/bin/env python2#g'
}

package() {
  cd ${srcdir}/${pkgname^}-${pkgver}

  msg 'Installing license...'
  install -Dm 644 LICENCE $pkgdir/usr/share/licenses/electrum/LICENSE
  install -Dm 644 AUTHORS $pkgdir/usr/share/licenses/electrum/AUTHORS

  msg 'Installing documentation...'
  for $_doc in README RELEASE-NOTES; do
    install -Dm 644 $_doc $pkgdir/usr/share/doc/electrum/$_doc
  done

  msg 'Installing appdirs...'
  install -dm 755 $pkgdir/usr/share/electrum
  for _appdir in contrib data docs gui icons lib plugins pubkeys scripts; do
    mv $_appdir $pkgdir/usr/share/electrum/$_appdir
  done

  msg 'Installing appfiles...'
  for _appfile in app.fil electrum electrum.conf.sample electrum.desktop electrum.icns icons.qrc Info.plist make_packages MANIFEST.in mki18n.py setup.py setup-release.py; do
    mv $_appfile $pkgdir/usr/share/electrum/$_appfile
  done
}
