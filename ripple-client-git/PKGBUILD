# Maintainer: Andy Weidenbaum <archbaum@gmail.com>

pkgname=ripple-client-git
_gitname="ripple-client"
pkgver=8a610fd
pkgrel=2
pkgdesc="Client for the Ripple payment network"
arch=('any')
depends=('nodejs')
makedepends=('git' 'nodejs-grunt-cli')
url="https://github.com/rippleFoundation/ripple-client"
license=('MIT')
source=(git://github.com/rippleFoundation/ripple-client.git
        ripple-client.install
        ripple-client.sh)
sha256sums=('SKIP'
            'c51ee81d63bf807f68200d0bd7454b77041abf21b38adc3dcc2439f64123222f'
            'b8015eea0f0deccca54117fd9f788d560ba7a70df3df701cdbce73758fc69d81')
provides=('ripple-client')
conflicts=('ripple-client')
install=ripple-client.install

_insdir="/opt/${_gitname}"

pkgver() {
  cd $_gitname
  git describe --always | sed 's|-|.|g'
}

package() {
  mkdir -p "${pkgdir}/${_insdir}"
  cp -rf "${_gitname}/"* "${pkgdir}/${_insdir}"

  msg 'Installing NPM dependencies...'
  cd "${pkgdir}/${_insdir}"
  npm install -d

  msg 'Building with grunt...'
  grunt

  msg 'Creating default config.js file...'
  cp config-example.js config.js

  msg 'Installing executable...'
  install -Dm755 "${srcdir}"/ripple-client.sh "${pkgdir}"/usr/bin/${_gitname}

  msg 'Cleaning up pkgdir...'
  find "$pkgdir" -type d -name .git -exec rm -r '{}' +
}
